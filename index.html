<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>TeaVM WebAssembly Demo</title>
</head>
<body>

    <h1>WebAssembly (WASM) Demo mit Java/TeaVM</h1>
    <p id="output">WASM wird geladen...</p>
    
    <button onclick="calculateSum()">Zahlen addieren (in WASM)</button>
    <p id="result">Ergebnis:</p>

    <script src="target/teavm/classes.wasm-runtime.js"></script> 

    <script>
        let teavmInstance = null;
        const WASM_PATH = 'target/teavm/classes.wasm';

        // 1. Hauptfunktion zum Laden des WASM-Moduls
        async function loadWasm() {
            try {
                // Laden des WASM-Moduls mithilfe des TeaVM-Loaders
                teavmInstance = await TeaVM.wasm.load(WASM_PATH);
                
                // 2. Aufruf der initialisierenden Export-Methode
                // Diese Methode enth√§lt den @JSBody-Code, der das DOM aktualisiert.
                console.log(teavmInstance.instance.exports)
                if (teavmInstance.instance.exports.initializeApp) {
                    teavmInstance.instance.exports.initializeApp();
                } else {
                    console.error("initializeApp wurde nicht exportiert!");
                }
            } catch (error) {
                console.error("Fehler beim Laden des WASM-Moduls:", error);
                document.getElementById('output').textContent = "Laden fehlgeschlagen: " + error.message;
            }
        }

        // 3. Funktion zum Aufruf der Additionsmethode
        function calculateSum() {
            if (!teavmInstance) {
                document.getElementById('result').textContent = 'WASM ist noch nicht geladen.';
                return;
            }
            
            const numA = 42;
            const numB = 17;
            
            // Aufruf der Java-Methode, die in WASM kompiliert wurde
            // Der Name (addNumbers) entspricht dem @Export(name = "...") in Ihrer Java-Klasse
            const sum = teavmInstance.instance.exports.addNumbers(numA, numB);
            
            document.getElementById('result').textContent = `Ergebnis von ${numA} + ${numB} (aus WASM): ${sum}`;
        }

        // Starten Sie den Ladevorgang, sobald das DOM bereit ist
        document.addEventListener('DOMContentLoaded', loadWasm);
    </script>

</body>
</html>